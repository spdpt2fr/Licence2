<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Diagnostic - Licence2 v3.0</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Supabase CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <!-- Page de connexion -->
    <div id="loginPage" class="login-page">
      <form id="loginForm" class="login-form">
        <h2>Connexion v3.0 - Test Diagnostic</h2>
        <input id="loginUser" type="text" placeholder="Login" required />
        <input id="loginPass" type="password" placeholder="Mot de passe" required />
        <button type="submit" class="btn btn-primary">Se connecter</button>
        <p class="login-hint">Identifiants par d√©faut: <b>Admin/Admin</b></p>
      </form>
    </div>

    <!-- Application principale -->
    <div id="mainApp" class="container hidden">
      <h1>Application Licence2 v3.0</h1>
      <p>Test de diagnostic r√©ussi !</p>
      <div id="headerContainer"></div>
      <div id="alertsContainer"></div>
      <div id="tableContainer"></div>
    </div>

    <!-- Test diagnostic modulaire -->
    <script type="module">
      console.log('üîç DIAGNOSTIC: D√©but du test modulaire');
      
      try {
        // Test 1: Import configuration
        console.log('üìÅ Test 1: Import config...');
        const { APP_CONFIG } = await import('./src/config/app.config.js');
        console.log('‚úÖ Config import√©e:', APP_CONFIG);
        
        // Test 2: Import constantes  
        console.log('üìÅ Test 2: Import constantes...');
        const { EVENTS } = await import('./src/config/constants.js');
        console.log('‚úÖ Constantes import√©es:', EVENTS);
        
        // Test 3: Import Supabase config
        console.log('üìÅ Test 3: Import Supabase...');
        const { initSupabase } = await import('./src/config/supabase.config.js');
        console.log('‚úÖ Supabase config import√©e');
        
        // Test 4: Import API Base
        console.log('üìÅ Test 4: Import BaseAPI...');
        const BaseAPI = await import('./src/core/api/base.js');
        console.log('‚úÖ BaseAPI import√©e:', BaseAPI);
        
        // Test 5: Import API Users
        console.log('üìÅ Test 5: Import UsersAPI...');
        const UsersAPI = await import('./src/core/api/users.js');
        console.log('‚úÖ UsersAPI import√©e:', UsersAPI);
        
        // Test 6: Import utils
        console.log('üìÅ Test 6: Import utils...');
        const { notifications } = await import('./src/utils/notifications.js');
        console.log('‚úÖ Notifications import√©es:', notifications);
        
        // Test 7: Import app principal
        console.log('üìÅ Test 7: Import app principal...');
        const app = await import('./src/app.js');
        console.log('‚úÖ App principale import√©e:', app);
        
        // Success - L'application fonctionne
        window.licence2App = app.default;
        console.log('üéâ DIAGNOSTIC R√âUSSI: Tous les modules import√©s');
        
        // Initialiser l'app
        await window.licence2App.init();
        console.log('üöÄ Application initialis√©e avec succ√®s');
        
      } catch (error) {
        console.error('‚ùå DIAGNOSTIC √âCHOU√â:', error);
        console.error('Stack:', error.stack);
        alert('Erreur module: ' + error.message);
      }
      
      // Gestion connexion simplifi√©e
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('loginUser').value.trim();
        const password = document.getElementById('loginPass').value;
        
        console.log('üîë Tentative de connexion:', username);
        
        if (window.licence2App) {
          try {
            const result = await window.licence2App.login(username, password);
            console.log('üîë R√©sultat connexion:', result);
            
            if (result.success) {
              document.getElementById('loginPage').classList.add('hidden');
              document.getElementById('mainApp').classList.remove('hidden');
              console.log('‚úÖ Connexion r√©ussie');
            } else {
              alert('Connexion √©chou√©e: ' + (result.error || 'Identifiants incorrects'));
            }
          } catch (error) {
            console.error('‚ùå Erreur connexion:', error);
            alert('Erreur: ' + error.message);
          }
        } else {
          alert('Application non initialis√©e');
        }
      });
    </script>
  </body>
</html>