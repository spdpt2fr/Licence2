<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestionnaire de Licences - Auth Simple</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Supabase CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
      /* Styles pour le menu administration */
      .admin-menu {
        display: none;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 0.75rem 1rem;
        margin-bottom: 1rem;
        border-radius: 8px;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .admin-menu.visible {
        display: flex;
      }
      
      .admin-menu-title {
        color: white;
        font-weight: bold;
        margin: 0;
        font-size: 1rem;
      }
      
      .admin-menu-buttons {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
      
      .admin-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 0.5rem 1rem;
        border-radius: 5px;
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
      }
      
      .admin-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        color: white;
        text-decoration: none;
        transform: translateY(-1px);
      }
      
      @media (max-width: 768px) {
        .admin-menu {
          flex-direction: column;
          gap: 0.75rem;
          text-align: center;
        }
        
        .admin-menu-buttons {
          justify-content: center;
        }
        
        .admin-btn {
          font-size: 0.8rem;
          padding: 0.4rem 0.8rem;
        }
        
        .admin-btn span.text {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- Page de connexion -->
    <div id="loginPage" class="login-page">
      <form id="loginForm" class="login-form">
        <h2>üîê Connexion</h2>
        <div class="form-group">
          <input id="loginUser" type="text" placeholder="Identifiant" required autocomplete="username" />
        </div>
        <div class="form-group">
          <input id="loginPass" type="password" placeholder="Mot de passe" required autocomplete="current-password" />
        </div>
        <button type="submit" class="btn btn-primary">Se connecter</button>
        <div id="loginAttempts" class="login-attempts hidden"></div>
        <p class="security-notice">üõ°Ô∏è Authentification simple avec base de donn√©es</p>
        <p class="hint-text" style="font-size: 0.85rem; color: #888; margin-top: 1rem;">
          Identifiants par d√©faut : admin / admin
        </p>
      </form>
    </div>

    <!-- Application principale -->
    <div id="mainApp" class="container hidden">
      <!-- Header -->
      <div class="app-header">
        <h1>Gestionnaire de Licences</h1>
        <div class="header-user">
          <div class="status-bar">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">Chargement...</span>
          </div>
          <div class="current-user" id="currentUser">Utilisateur</div>
          <button id="logoutBtn" class="btn btn-secondary">D√©connexion</button>
        </div>
      </div>

      <!-- Menu Administration (visible uniquement pour les admins) -->
      <div id="adminMenu" class="admin-menu">
        <h3 class="admin-menu-title">üõ†Ô∏è Administration</h3>
        <div class="admin-menu-buttons">
          <button id="usersManagementBtn" class="admin-btn">
            üë• <span class="text">Utilisateurs</span>
          </button>
          <button class="admin-btn" onclick="window.UIManager.showNotification('Fonctionnalit√© √† venir', 'info')">
            ‚öôÔ∏è <span class="text">Param√®tres</span>
          </button>
        </div>
      </div>

      <!-- Alertes -->
      <div id="alertsContainer"></div>

      <!-- Actions du tableau -->
      <div class="table-container">
        <div class="table-header">
          <div class="table-actions">
            <div class="search-container">
              <input type="text" id="searchInput" placeholder="Rechercher une licence..." />
              <div class="count" id="licenceCount">0 licence(s)</div>
            </div>
            <button id="addLicenceBtn" class="btn btn-primary">
              ‚ûï Nouvelle licence
            </button>
            <button id="refreshBtn" class="btn btn-secondary">
              üîÑ Actualiser
            </button>
          </div>
        </div>

        <!-- Tableau des licences -->
        <table class="licence-table">
          <thead>
            <tr>
              <th onclick="sortTable('id')">ID</th>
              <th onclick="sortTable('software_name')">Logiciel</th>
              <th onclick="sortTable('vendor')">Fournisseur</th>
              <th onclick="sortTable('version')">Version</th>
              <th onclick="sortTable('type')">Type</th>
              <th onclick="sortTable('expiration_date')">Expiration</th>
              <th onclick="sortTable('initial_cost')">Prix</th>
              <th onclick="sortTable('seats')">Postes</th>
              <th onclick="sortTable('commentaires')">Commentaires</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="licenceTableBody">
            <!-- Les licences seront inject√©es ici -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal pour ajouter/√©diter une licence -->
    <div id="licenceModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Nouvelle licence</h3>
          <button id="closeModalBtn" class="close-btn">‚úï</button>
        </div>
        <form id="licenceForm" class="modal-body">
          <div class="form-group">
            <label for="software_name">Nom du logiciel *</label>
            <input type="text" id="software_name" name="software_name" required />
          </div>
          
          <div class="form-group">
            <label for="vendor">Fournisseur *</label>
            <input type="text" id="vendor" name="vendor" required />
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="version">Version</label>
              <input type="text" id="version" name="version" />
            </div>
            
            <div class="form-group">
              <label for="type">Type *</label>
              <select id="type" name="type" required>
                <option value="">S√©lectionner...</option>
                <option value="perpetuelle">Perp√©tuelle</option>
                <option value="subscription">Abonnement</option>
                <option value="trial">Essai</option>
                <option value="educational">√âducation</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="purchase_date">Date d'achat</label>
              <input type="date" id="purchase_date" name="purchase_date" />
            </div>
            
            <div class="form-group">
              <label for="expiration_date">Date d'expiration</label>
              <input type="date" id="expiration_date" name="expiration_date" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="initial_cost">Prix (‚Ç¨)</label>
              <input type="number" id="initial_cost" name="initial_cost" step="0.01" min="0" />
            </div>
            
            <div class="form-group">
              <label for="seats">Nombre de postes</label>
              <input type="number" id="seats" name="seats" min="1" value="1" />
            </div>
          </div>
          
          <div class="form-group">
            <label for="assigned_to">Assign√© √†</label>
            <input type="text" id="assigned_to" name="assigned_to" placeholder="Nom d'utilisateur ou √©quipe" />
          </div>
          
          <div class="form-group">
            <label for="commentaires">Commentaires</label>
            <textarea id="commentaires" name="commentaires" 
                     placeholder="Commentaires libres sur cette licence..." 
                     rows="3"></textarea>
          </div>
          
          <div class="modal-footer">
            <button type="button" id="cancelBtn" class="btn btn-secondary">Annuler</button>
            <button type="submit" id="saveBtn" class="btn btn-primary">
              <span id="saveText">Cr√©er</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal de gestion des utilisateurs -->
    <div id="usersModal" class="modal hidden">
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h3>üë• Gestion des Utilisateurs</h3>
          <button id="closeUsersModalBtn" class="close-btn">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="table-actions" style="margin-bottom: 1rem;">
            <button id="addUserBtn" class="btn btn-primary">‚ûï Nouvel utilisateur</button>
            <button id="refreshUsersBtn" class="btn btn-secondary">üîÑ Actualiser</button>
          </div>
          <table class="licence-table">
            <thead>
              <tr>
                <th>Login</th>
                <th>Nom</th>
                <th>Email</th>
                <th>R√¥le</th>
                <th>Statut</th>
                <th>Derni√®re connexion</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <!-- Les utilisateurs seront inject√©s ici -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal pour ajouter/√©diter un utilisateur -->
    <div id="userFormModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="userModalTitle">Nouvel utilisateur</h3>
          <button id="closeUserFormBtn" class="close-btn">‚úï</button>
        </div>
        <form id="userForm" class="modal-body">
          <div class="form-group">
            <label for="user_login">Identifiant *</label>
            <input type="text" id="user_login" name="login" required />
          </div>
          
          <div class="form-group">
            <label for="user_nom">Nom complet *</label>
            <input type="text" id="user_nom" name="nom" required />
          </div>
          
          <div class="form-group">
            <label for="user_email">Email *</label>
            <input type="email" id="user_email" name="email" required />
          </div>
          
          <div class="form-group">
            <label for="user_password">Mot de passe *</label>
            <input type="password" id="user_password" name="password" placeholder="Minimum 6 caract√®res" />
            <small id="passwordHelp" style="color: #888;">Laissez vide pour conserver le mot de passe actuel</small>
          </div>
          
          <div class="form-group">
            <label for="user_role">R√¥le *</label>
            <select id="user_role" name="role" required>
              <option value="user">Utilisateur</option>
              <option value="manager">Manager</option>
              <option value="admin">Administrateur</option>
            </select>
          </div>
          
          <div class="modal-footer">
            <button type="button" id="cancelUserBtn" class="btn btn-secondary">Annuler</button>
            <button type="submit" id="saveUserBtn" class="btn btn-primary">
              <span id="saveUserText">Cr√©er</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Scripts JavaScript modulaires -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/database.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/licences.js"></script>
    <script src="js/users-ui.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>