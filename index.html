<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestionnaire de Licences v3.0 - Architecture Modulaire</title>
    <link rel="stylesheet" href="style.css" />

    <!-- Supabase CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <!-- Page de connexion -->
    <div id="loginPage" class="login-page">
      <form id="loginForm" class="login-form">
        <h2>Connexion v3.0</h2>
        <input id="loginUser" type="text" placeholder="Login" required />
        <input id="loginPass" type="password" placeholder="Mot de passe" required />
        <button type="submit" class="btn btn-primary">Se connecter</button>
        <p class="login-hint">Identifiants par d√©faut: <b>Admin/Admin</b></p>
      </form>
    </div>

    <!-- Application principale -->
    <div id="mainApp" class="container hidden">
      <!-- Le header sera inject√© ici par HeaderComponent -->
      <div id="headerContainer"></div>
      
      <!-- Les alertes seront inject√©es ici par AlertsComponent -->
      <div id="alertsContainer"></div>
      
      <!-- Le tableau sera inject√© ici par LicenceTableComponent -->
      <div id="tableContainer"></div>
    </div>

    <!-- Point d'entr√©e modulaire -->
    <script type="module">
      // Import corrrig√© avec export par d√©faut
      import app from './src/app.js';
      
      // Instance globale de l'application
      window.licence2App = app;
      
      // Initialisation au chargement
      document.addEventListener('DOMContentLoaded', async () => {
        console.log('üöÄ D√©marrage Licence2 v3.0 - Architecture Modulaire');
        
        try {
          await window.licence2App.init();
          console.log('‚úÖ Application initialis√©e avec succ√®s');
        } catch (error) {
          console.error('‚ùå Erreur initialisation:', error);
          alert('Erreur lors de l\'initialisation de l\'application');
        }
      });
      
      // Gestion de la connexion
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('loginUser').value.trim();
        const password = document.getElementById('loginPass').value;
        
        try {
          const result = await window.licence2App.login(username, password);
          
          if (result.success) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
          }
        } catch (error) {
          console.error('Erreur de connexion:', error);
          alert('Erreur de connexion: ' + error.message);
        }
      });
    </script>
  </body>
</html>